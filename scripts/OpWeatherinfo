#!/bin/sh

# Fetch weather data from OpenWeather API
API_KEY=""
LAT=""
LON=""
WEATHER_URL="https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&appid=${API_KEY}"

WEATHER_DATA=$(curl -s "$WEATHER_URL")

# Extract weather information using jq
TEMP=$(printf '%s' "$WEATHER_DATA" | jq '.main.temp' -r)
FEELS_LIKE=$(printf '%s' "$WEATHER_DATA" | jq '.main.feels_like' -r)
WEATHER_MAIN=$(printf '%s' "$WEATHER_DATA" | jq '.weather[0].main' -r)
HUMIDITY=$(printf '%s' "$WEATHER_DATA" | jq '.main.humidity' -r)

# Convert temperature from Kelvin to Celsius
TEMP_C=$(printf '%.2f' "$(echo "$TEMP - 273.15" | bc)")
FEELS_LIKE_C=$(printf '%.2f' "$(echo "$FEELS_LIKE - 273.15" | bc)")

# Define icons for weather conditions
case $WEATHER_MAIN in
  Clear) ICON="â˜€ï¸" ;;
  "Few Clouds") ICON="ðŸŒ¤ï¸" ;;
  "Scattered Clouds") ICON="â›…" ;;
  "Broken Clouds") ICON="ðŸŒ¥ï¸" ;;
  Clouds) ICON="â˜ï¸" ;;
  "Light Rain") ICON="ðŸŒ¦ï¸" ;;
  Rain) ICON="ðŸŒ§ï¸" ;;
  "Heavy Rain") ICON="ðŸŒŠ" ;;
  Drizzle) ICON="ðŸŒ¦ï¸" ;;
  Thunderstorm) ICON="â›ˆï¸" ;;
  "Light Snow") ICON="ðŸŒ¨ï¸" ;;
  Snow) ICON="â„ï¸" ;;
  "Heavy Snow") ICON="â›„" ;;
  Mist|Haze) ICON="ðŸŒ«ï¸" ;;
  Smoke) ICON="ðŸ’¨" ;;
  Dust) ICON="ðŸŒªï¸" ;;
  Fog) ICON="ðŸŒ" ;;
  Sand) ICON="ðŸœï¸" ;;
  Ash) ICON="ðŸŒ‹" ;;
  Squall) ICON="ðŸ’¨" ;;
  Tornado) ICON="ðŸŒªï¸" ;;
  *) ICON="ðŸŒˆ" ;;
esac

# Define temperature icons based on Celsius value
if [ "$(printf '%.0f\n' "$(printf '%s > 27\n' "$TEMP_C" | bc)")" -eq 1 ]; then
    TEMP_ICON="î¼ª"  # Above 27Â°C
elif [ "$(printf '%.0f\n' "$(printf '%s >= 20 && %s <= 27\n' "$TEMP_C" "$TEMP_C" | bc)")" -eq 1 ]; then
    TEMP_ICON="ï‹‰"  # Between 20Â°C and 27Â°C
elif [ "$(printf '%.0f\n' "$(printf '%s >= 5 && %s < 18\n' "$TEMP_C" "$TEMP_C" | bc)")" -eq 1 ]; then
    TEMP_ICON="î¼«"  # Between 5Â°C and 18Â°C
else
    TEMP_ICON="ï‹‹"  # Below 5Â°C
fi

# Print weather information in a single line with temperature icon
printf '%s %s%.0fÂ°C(%.0fÂ°C)ðŸ’§%s%%\n' "$ICON" "$TEMP_ICON" "$TEMP_C" "$FEELS_LIKE_C" "$HUMIDITY"
exit 0
